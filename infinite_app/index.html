<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¬´í•œë§¤ìˆ˜ë²• ê³„ì‚°ê¸°</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (JSX ë³€í™˜ìš©) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PWA Manifest ì—°ê²° -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4f46e5">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2666/2666505.png">

    <style>
        /* ëª¨ë°”ì¼ í„°ì¹˜ê° ê°œì„  */
        button { cursor: pointer; touch-action: manipulation; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ (Lucide React ëŒ€ì²´) ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg 
                xmlns="http://www.w3.org/2000/svg" 
                width={size} 
                height={size} 
                viewBox="0 0 24 24" 
                fill="none" 
                stroke="currentColor" 
                strokeWidth="2" 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                className={className}
            >
                {path}
            </svg>
        );

        const Icons = {
            TrendingUp: (props) => <Icon {...props} path={<><polyline points="23 6 13.5 15.5 8.5 10.5 1 18" /><polyline points="17 6 23 6 23 12" /></>} />,
            Menu: (props) => <Icon {...props} path={<><line x1="4" x2="20" y1="12" y2="12" /><line x1="4" x2="20" y1="6" y2="6" /><line x1="4" x2="20" y1="18" y2="18" /></>} />,
            X: (props) => <Icon {...props} path={<><path d="M18 6 6 18" /><path d="m6 6 12 12" /></>} />,
            Info: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><path d="M12 16v-4" /><path d="M12 8h.01" /></>} />,
            Calculator: (props) => <Icon {...props} path={<><rect width="16" height="20" x="4" y="2" rx="2" /><line x1="8" x2="16" y1="6" y2="6" /><line x1="16" x2="16" y1="14" y2="18" /><path d="M16 10h.01" /><path d="M12 10h.01" /><path d="M8 10h.01" /><path d="M12 14h.01" /><path d="M8 14h.01" /><path d="M12 18h.01" /><path d="M8 18h.01" /></>} />,
            Briefcase: (props) => <Icon {...props} path={<><rect width="20" height="14" x="2" y="7" rx="2" ry="2" /><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16" /></>} />,
            ArrowRight: (props) => <Icon {...props} path={<><path d="M5 12h14" /><path d="m12 5 7 7-7 7" /></>} />,
            ArrowLeft: (props) => <Icon {...props} path={<><path d="m12 19-7-7 7-7" /><path d="M19 12H5" /></>} />,
            AlertCircle: (props) => <Icon {...props} path={<><circle cx="12" cy="12" r="10" /><line x1="12" x2="12" y1="8" y2="12" /><line x1="12" x2="12.01" y1="16" y2="16" /></>} />,
            BookOpen: (props) => <Icon {...props} path={<><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></>} />,
            AlertTriangle: (props) => <Icon {...props} path={<><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><path d="M12 9v4" /><path d="M12 17h.01" /></>} />,
            Scale: (props) => <Icon {...props} path={<><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" /><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z" /><path d="M7 21h10" /><path d="M12 3v18" /><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2" /></>} />,
            Download: (props) => <Icon {...props} path={<><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></>} />
        };

        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---
        const formatCurrency = (value) => {
            if (value === '' || value === null || isNaN(value)) return '$0.00';
            return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(value);
        };

        const formatNumber = (value) => {
            if (value === '' || value === null || isNaN(value)) return '0';
            return new Intl.NumberFormat('en-US').format(value);
        };

        // --- ë©”ì¸ ì•± ì»´í¬ë„ŒíŠ¸ ---
        function App() {
            const [currentView, setCurrentView] = useState('home');
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [deferredPrompt, setDeferredPrompt] = useState(null);
            const [isInstallable, setIsInstallable] = useState(false);

            useEffect(() => {
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    setDeferredPrompt(e);
                    setIsInstallable(true);
                };

                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);

                return () => {
                    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                };
            }, []);

            const handleInstallClick = async () => {
                if (!deferredPrompt) return;
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                setDeferredPrompt(null);
                setIsInstallable(false);
            };

            const renderContent = () => {
                switch (currentView) {
                    case 'home': return <HomeView onChangeView={setCurrentView} />;
                    case 'v2': return <Version2Calculator onBack={() => setCurrentView('home')} />;
                    case 'v3': return <Version3Calculator onBack={() => setCurrentView('home')} />;
                    default: return <HomeView onChangeView={setCurrentView} />;
                }
            };

            return (
                <div className="min-h-screen bg-slate-50 text-slate-900 font-sans flex flex-col md:flex-row">
                    {/* ëª¨ë°”ì¼ í—¤ë” */}
                    <div className="md:hidden bg-indigo-600 text-white p-4 flex justify-between items-center shadow-md z-50 sticky top-0">
                        <h1 className="text-xl font-bold flex items-center gap-2">
                            <Icons.TrendingUp size={24} /> ë¬´í•œë§¤ìˆ˜ë²•
                        </h1>
                        <button onClick={() => setIsMobileMenuOpen(!isMobileMenuOpen)}>
                            {isMobileMenuOpen ? <Icons.X /> : <Icons.Menu />}
                        </button>
                    </div>

                    {/* ì‚¬ì´ë“œë°” */}
                    <nav className={`
                        fixed inset-0 z-40 bg-slate-900 text-white transition-transform duration-300 transform 
                        ${isMobileMenuOpen ? 'translate-x-0' : '-translate-x-full'}
                        md:relative md:translate-x-0 md:w-64 md:flex-shrink-0 md:flex md:flex-col md:justify-between
                    `}>
                        <div className="p-6 pt-20 md:pt-6"> 
                            <h1 className="text-2xl font-bold mb-8 hidden md:flex items-center gap-2">
                                <Icons.TrendingUp className="text-indigo-400" /> ë¬´í•œë§¤ìˆ˜ë²•
                            </h1>
                            <div className="space-y-2">
                                <NavButton 
                                    active={currentView === 'home'} 
                                    onClick={() => { setCurrentView('home'); setIsMobileMenuOpen(false); }}
                                    icon={<Icons.Info size={20} />}
                                    label="ì†Œê°œ ë° ê°€ì´ë“œ"
                                />
                                <NavButton 
                                    active={currentView === 'v2'} 
                                    onClick={() => { setCurrentView('v2'); setIsMobileMenuOpen(false); }}
                                    icon={<Icons.Calculator size={20} />}
                                    label="V2.2 ê³„ì‚°ê¸°"
                                />
                                <NavButton 
                                    active={currentView === 'v3'} 
                                    onClick={() => { setCurrentView('v3'); setIsMobileMenuOpen(false); }}
                                    icon={<Icons.Briefcase size={20} />}
                                    label="V3.0 (20ë¶„í• )"
                                />
                                
                                {isInstallable && (
                                    <button
                                        onClick={handleInstallClick}
                                        className="w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors bg-emerald-600 hover:bg-emerald-700 text-white mt-4 shadow-lg animate-pulse"
                                    >
                                        <Icons.Download size={20} />
                                        <span className="font-medium">ì•± ì„¤ì¹˜í•˜ê¸°</span>
                                    </button>
                                )}
                            </div>
                        </div>
                        <div className="p-6 text-slate-400 text-sm">
                            <p>Â© 2024 Infinite Buying</p>
                            <p>íˆ¬ìì˜ ì±…ì„ì€ ë³¸ì¸ì—ê²Œ ìˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </nav>

                    <main className="flex-1 overflow-y-auto p-4 md:p-8">
                        {renderContent()}
                    </main>
                </div>
            );
        }

        function NavButton({ active, onClick, icon, label }) {
            return (
                <button
                    onClick={onClick}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${
                        active 
                        ? 'bg-indigo-600 text-white shadow-lg' 
                        : 'hover:bg-slate-800 text-slate-300'
                    }`}
                >
                    {icon}
                    <span className="font-medium">{label}</span>
                </button>
            );
        }

        function HomeView({ onChangeView }) {
            const [activeTab, setActiveTab] = useState('v2');

            return (
                <div className="max-w-4xl mx-auto space-y-8">
                    <div className="bg-white rounded-2xl p-8 shadow-sm border border-slate-100">
                        <h2 className="text-3xl font-bold text-slate-900 mb-4">ë¬´í•œë§¤ìˆ˜ë²• ë„ìš°ë¯¸</h2>
                        <p className="text-slate-600 text-lg leading-relaxed mb-6">
                            ë¼ì˜¤ì–´ë‹˜ì˜ ë¬´í•œë§¤ìˆ˜ë²• ì•Œê³ ë¦¬ì¦˜ì„ ê¸°ë°˜ìœ¼ë¡œ ë§¤ì¼ì˜ ë§¤ìˆ˜/ë§¤ë„ ê°€ê²©ì„ ê³„ì‚°í•´ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
                            ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë°”ë¡œ ê³„ì‚°ê¸°ë¥¼ ì‚¬ìš©í•˜ê±°ë‚˜, í•˜ë‹¨ì˜ ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
                        </p>
                        
                        <div className="grid md:grid-cols-2 gap-6">
                            <div 
                                onClick={() => onChangeView('v2')}
                                className="group cursor-pointer bg-slate-50 border border-slate-200 rounded-xl p-6 hover:border-indigo-500 hover:shadow-md transition-all"
                            >
                                <div className="flex justify-between items-start mb-4">
                                    <div className="bg-indigo-100 p-3 rounded-lg text-indigo-600">
                                        <Icons.Calculator size={24} />
                                    </div>
                                    <Icons.ArrowRight className="text-slate-300 group-hover:text-indigo-500 transition-colors" />
                                </div>
                                <h3 className="text-xl font-bold mb-2">V2.2 ì˜¤ë¦¬ì§€ë„</h3>
                                <p className="text-slate-500">
                                    í‘œì¤€ 40ë¶„í•  ë²„ì „. ì „ë°˜ì „/í›„ë°˜ì „ ë° ì¿¼í„°ì†ì ˆ ë¡œì§ì„ ì§€ì›í•©ë‹ˆë‹¤.
                                </p>
                            </div>

                            <div 
                                onClick={() => onChangeView('v3')}
                                className="group cursor-pointer bg-slate-50 border border-slate-200 rounded-xl p-6 hover:border-indigo-500 hover:shadow-md transition-all"
                            >
                                <div className="flex justify-between items-start mb-4">
                                    <div className="bg-emerald-100 p-3 rounded-lg text-emerald-600">
                                        <Icons.Briefcase size={24} />
                                    </div>
                                    <Icons.ArrowRight className="text-slate-300 group-hover:text-emerald-500 transition-colors" />
                                </div>
                                <h3 className="text-xl font-bold mb-2">V3.0 (20ë¶„í• )</h3>
                                <p className="text-slate-500">
                                    TQQQ/SOXL ì „ìš© ê³ ìœ„í—˜ ë²„ì „. ë³„(%) ì§€í‘œì™€ ë³µë¦¬ íˆ¬ìë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                        <div className="border-b border-slate-100 flex overflow-x-auto">
                            <button onClick={() => setActiveTab('v2')} className={`px-6 py-4 font-medium whitespace-nowrap transition-colors ${activeTab === 'v2' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-slate-500 hover:text-slate-700'}`}>V2.2 ë§¤ìˆ˜/ë§¤ë„ ê¸°ì´ˆ</button>
                            <button onClick={() => setActiveTab('quarter')} className={`px-6 py-4 font-medium whitespace-nowrap transition-colors ${activeTab === 'quarter' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-slate-500 hover:text-slate-700'}`}>ì¿¼í„° ì†ì ˆëª¨ë“œë€?</button>
                            <button onClick={() => setActiveTab('diff')} className={`px-6 py-4 font-medium whitespace-nowrap transition-colors ${activeTab === 'diff' ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-slate-500 hover:text-slate-700'}`}>V2.2 vs V3.0 ì°¨ì´ì </button>
                        </div>

                        <div className="p-8 bg-slate-50/50">
                            {activeTab === 'v2' && (
                                <div className="space-y-6">
                                    <h3 className="text-xl font-bold flex items-center gap-2"><Icons.BookOpen size={24} className="text-indigo-500" />V2.2 ë§¤ìˆ˜/ë§¤ë„ í•µì‹¬ ë¡œì§</h3>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                            <h4 className="font-bold text-lg text-blue-700 mb-3">1. ë§¤ìˆ˜ (LOC)</h4>
                                            <p className="text-sm text-slate-600 mb-4">ë§¤ìˆ˜ëŠ” LOC(Limit On Close) ì£¼ë¬¸ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ì¢…ê°€ê°€ ì„¤ì •í•œ ê°€ê²©ë³´ë‹¤ ë‚®ê±°ë‚˜ ê°™ì„ ë•Œë§Œ ì²´ê²°ë©ë‹ˆë‹¤.</p>
                                            <ul className="space-y-3 text-sm">
                                                <li className="flex gap-2"><span className="font-bold text-slate-700 min-w-[60px]">ì „ë°˜ì „:</span><span>ì ˆë°˜ì€ <b>í‰ë‹¨ê°€(0%)</b>, ì ˆë°˜ì€ <b>(10-T/2)%</b> ì§€ì ì— LOC ë§¤ìˆ˜<br /><span className="text-slate-500 text-xs">(ì˜ˆ: T=6ì¼ ë•Œ, 10-3=7% ì§€ì )</span></span></li>
                                                <li className="flex gap-2"><span className="font-bold text-slate-700 min-w-[60px]">í›„ë°˜ì „:</span><span>1íšŒë¶„ ì „ì²´ë¥¼ <b>(10-T/2)%</b> ì§€ì ì— LOC ë§¤ìˆ˜<br /><span className="text-slate-500 text-xs">(ì˜ˆ: T=21ì¼ ë•Œ, 10-10.5 = -0.5% ì§€ì )</span></span></li>
                                            </ul>
                                        </div>
                                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                            <h4 className="font-bold text-lg text-rose-700 mb-3">2. ë§¤ë„ (ì§€ì •ê°€+LOC)</h4>
                                            <p className="text-sm text-slate-600 mb-4">ë§¤ë„ëŠ” ìš•ì‹¬ì„ ë¶€ë¦¬ì§€ ì•ŠëŠ” ë¶„í•  ë§¤ë„ ì „ëµì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
                                            <ul className="space-y-3 text-sm">
                                                <li className="flex gap-2"><span className="font-bold text-slate-700 min-w-[60px]">ê³µí†µ:</span><span>ëˆ„ì  ìˆ˜ëŸ‰ì˜ <b>1/4</b>ì€ <b>(10-T/2)%</b> LOC ë§¤ë„<br /><span className="text-slate-500 text-xs">(íƒˆì¶œìš© ì•ˆì „ë§ˆì§„)</span></span></li>
                                                <li className="flex gap-2"><span className="font-bold text-slate-700 min-w-[60px]">ê³µí†µ:</span><span>ë‚˜ë¨¸ì§€ <b>3/4</b>ì€ <b>10%</b> ì§€ì •ê°€ ë§¤ë„<br /><span className="text-slate-500 text-xs">(ìˆ˜ìµ ê·¹ëŒ€í™”ìš©)</span></span></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div className="bg-blue-50 p-4 rounded-lg text-sm text-blue-800">
                                        <strong>ğŸ’¡ ì‰¬ìš´ ì˜ˆì‹œ (T=8ì¼ ë•Œ):</strong> <br/>
                                        ê³µì‹ì€ 10 - (8/2) = 6%ì…ë‹ˆë‹¤. <br/>
                                        â€¢ ë§¤ìˆ˜: ì ˆë°˜ì€ ë‚´ í‰ë‹¨ê°€ì—, ì ˆë°˜ì€ í‰ë‹¨ê°€ë³´ë‹¤ 6% ë¹„ì‹¼ ê°€ê²©ì— LOCë¥¼ ê±¸ì–´ë‘¡ë‹ˆë‹¤.<br/>
                                        â€¢ ë§¤ë„: 1/4ì€ í‰ë‹¨ê°€ë³´ë‹¤ 6% ë¹„ì‹¼ ê°€ê²©ì—, 3/4ì€ 10% ë¹„ì‹¼ ê°€ê²©ì— ê±¸ì–´ë‘¡ë‹ˆë‹¤.
                                    </div>
                                </div>
                            )}
                            {activeTab === 'quarter' && (
                                <div className="space-y-6">
                                    <h3 className="text-xl font-bold flex items-center gap-2"><Icons.AlertTriangle size={24} className="text-amber-500" />ì¿¼í„° ì†ì ˆëª¨ë“œ (T &gt; 40)</h3>
                                    <p className="text-slate-600">40íšŒ(ì•½ 2ë‹¬) ë§¤ìˆ˜ë¥¼ ë‹¤ í–ˆëŠ”ë°ë„ íƒˆì¶œí•˜ì§€ ëª»í–ˆì„ ë•Œ ë°œë™í•©ë‹ˆë‹¤. ì–µì§€ë¡œ 1íšŒë¶„ì„ ë§Œë“¤ì–´ë‚´ê¸° ìœ„í•´ ì†ì ˆì„ ì„ì–´ì„œ ì§„í–‰í•©ë‹ˆë‹¤.</p>
                                    <div className="space-y-4">
                                        <div className="flex gap-4 items-start bg-white p-4 rounded-lg border border-slate-200">
                                            <div className="bg-slate-100 p-2 rounded-full font-bold text-slate-600">Step 1</div>
                                            <div><h4 className="font-bold text-slate-800">ì§„ì… ì‹œì  (T=40 ì¢…ë£Œ í›„)</h4><p className="text-sm text-slate-600">ê°€ì¥ ë¨¼ì € ë³´ìœ  ìˆ˜ëŸ‰ì˜ <b>1/4ì„ ì¢…ê°€(MOC)ë¡œ ë¬´ì¡°ê±´ ë§¤ë„</b>í•©ë‹ˆë‹¤. ì´ ë§¤ë„ê¸ˆìœ¼ë¡œ ë‹¤ì‹œ 10íšŒë¶„ì˜ ì´ì•Œì„ ë§Œë“­ë‹ˆë‹¤.</p></div>
                                        </div>
                                        <div className="flex gap-4 items-start bg-white p-4 rounded-lg border border-slate-200">
                                            <div className="bg-slate-100 p-2 rounded-full font-bold text-slate-600">Step 2</div>
                                            <div><h4 className="font-bold text-slate-800">ë§¤ìˆ˜ ë°©ë²•</h4><p className="text-sm text-slate-600">í‰ë‹¨ê°€ ëŒ€ë¹„ <b>-10% LOC</b> ë§¤ìˆ˜ë¡œ ì•„ì£¼ ë‚®ê²Œ ê±¸ì–´ë‘¡ë‹ˆë‹¤.</p></div>
                                        </div>
                                        <div className="flex gap-4 items-start bg-white p-4 rounded-lg border border-slate-200">
                                            <div className="bg-slate-100 p-2 rounded-full font-bold text-slate-600">Step 3</div>
                                            <div><h4 className="font-bold text-slate-800">ë§¤ë„ ë°©ë²•</h4><p className="text-sm text-slate-600">1/4 ë¬¼ëŸ‰ì€ <b>-10% LOC ë§¤ë„</b> (ì†ì ˆí•˜ë©° ìˆ˜ëŸ‰ ì¤„ì´ê¸°),<br/>ë‚˜ë¨¸ì§€ 3/4 ë¬¼ëŸ‰ì€ <b>10% ì§€ì •ê°€ ë§¤ë„</b> (ë³¸ì „/ìµì ˆ)ë¥¼ ê²ë‹ˆë‹¤.</p></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {activeTab === 'diff' && (
                                <div className="space-y-6">
                                    <h3 className="text-xl font-bold flex items-center gap-2"><Icons.Scale size={24} className="text-emerald-500" />V2.2 vs V3.0 ë¹„êµ</h3>
                                    <div className="overflow-hidden border border-slate-200 rounded-xl">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-slate-100 text-slate-700">
                                                <tr><th className="p-4">êµ¬ë¶„</th><th className="p-4 text-indigo-700">V2.2 (ì˜¤ë¦¬ì§€ë„)</th><th className="p-4 text-emerald-700">V3.0 (ê³ ìœ„í—˜)</th></tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-200 bg-white">
                                                <tr><td className="p-4 font-bold text-slate-600">ë¶„í•  íšŸìˆ˜</td><td className="p-4">40ë¶„í•  (ì•ˆì •ì )</td><td className="p-4">20ë¶„í•  (ê³µê²©ì )</td></tr>
                                                <tr><td className="p-4 font-bold text-slate-600">ì¶”ì²œ ëŒ€ìƒ</td><td className="p-4">ì´ˆë³´ì, ëª¨ë“  3ë°° ë ˆë²„ë¦¬ì§€</td><td className="p-4">ìˆ™ë ¨ì, TQQQ/SOXL ì „ìš©</td></tr>
                                                <tr><td className="p-4 font-bold text-slate-600">ë§¤ë§¤ ê¸°ì¤€</td><td className="p-4">ê³ ì • ê³µì‹ (10-T/2)</td><td className="p-4">ì¢…ëª©ë³„ ê³µì‹ (ë³„% ì§€í‘œ)</td></tr>
                                                <tr><td className="p-4 font-bold text-slate-600">ìˆ˜ìµê¸ˆ ì²˜ë¦¬</td><td className="p-4">ë§¤ ì‚¬ì´í´ ì¢…ë£Œ í›„ ë°˜ì˜</td><td className="p-4">ì‹¤ì‹œê°„ ë³µë¦¬ (1íšŒ ë§¤ìˆ˜ê¸ˆ ì¦ê°€)</td></tr>
                                                <tr><td className="p-4 font-bold text-slate-600">ì¤‘ê°„ ì •ì‚°</td><td className="p-4">ì—†ìŒ (40íšŒê¹Œì§€ ì§„í–‰)</td><td className="p-4">T=20ì—ì„œ ì¿¼í„°ë§¤ë„(1/4 MOC)</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div className="bg-amber-50 p-4 rounded-lg text-sm text-amber-800 flex gap-2">
                                        <Icons.AlertCircle size={16} className="mt-0.5 flex-shrink-0" />
                                        <p><strong>ì£¼ì˜:</strong> V3.0ì€ 20ë¶„í• ì´ë¯€ë¡œ í•˜ë½ì¥ì—ì„œ ìê¸ˆì´ ë¹ ë¥´ê²Œ ì†Œì§„ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì²˜ìŒ í•˜ì‹œëŠ” ë¶„ì€ V2.2ë¡œ ìµœì†Œ 6ê°œì›” ì´ìƒ ê²½í—˜ì„ ìŒ“ìœ¼ì‹œê¸¸ ê¶Œì¥í•©ë‹ˆë‹¤.</p>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function InputField({ label, value, onChange, type = "number", placeholder, step="0.01", prefix }) {
            return (
                <div className="space-y-1">
                    <label className="text-sm font-semibold text-slate-500 uppercase tracking-wide">{label}</label>
                    <div className="relative">
                        {prefix && (<div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><span className="text-slate-400">{prefix}</span></div>)}
                        <input type={type} value={value} onChange={(e) => onChange(e.target.value)} placeholder={placeholder} step={step} className={`block w-full rounded-lg border-slate-200 bg-slate-50 focus:border-indigo-500 focus:ring-indigo-500 p-3 text-slate-900 ${prefix ? 'pl-8' : ''}`} />
                    </div>
                </div>
            );
        }

        function Version2Calculator({ onBack }) {
            const [tValue, setTValue] = useState(1);
            const [avgPrice, setAvgPrice] = useState('');
            const [oneTimeBuyAmount, setOneTimeBuyAmount] = useState('');
            const [totalQuantity, setTotalQuantity] = useState('');

            const calculateV2 = () => {
                const t = parseFloat(tValue) || 0;
                const avg = parseFloat(avgPrice) || 0;
                const qty = parseFloat(totalQuantity) || 0;
                const buyAmt = parseFloat(oneTimeBuyAmount) || 0;

                if (!avg || !buyAmt) return null;

                let mode = '';
                let buyOrders = [];
                let sellOrders = [];
                let message = '';

                if (t > 40) {
                    mode = 'ì¿¼í„°ì†ì ˆ ëª¨ë“œ';
                    message = '40íšŒ ë§¤ìˆ˜ê°€ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê¸°ì¡´ 1íšŒ ë§¤ìˆ˜ê¸ˆ ìœ ì§€ ë˜ëŠ” ì¬ê³„ì‚°(ë‚¨ì€ìê¸ˆ/10) í›„ ì§„í–‰í•˜ì„¸ìš”.';
                    buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg * 0.9, amount: '1íšŒë¶„', percent: '-10%' });
                    sellOrders.push({ type: 'LOC ë§¤ë„', price: avg * 0.9, qty: qty * 0.25, percent: '-10%' });
                    sellOrders.push({ type: 'ì§€ì •ê°€ ë§¤ë„', price: avg * 1.1, qty: qty * 0.75, percent: '+10%' });
                } else {
                    const locPercent = 10 - (t / 2);
                    sellOrders.push({ type: 'LOC ë§¤ë„', price: avg * (1 + locPercent/100), qty: qty * 0.25, percent: `${locPercent}%` });
                    sellOrders.push({ type: 'ì§€ì •ê°€ ë§¤ë„', price: avg * 1.1, qty: qty * 0.75, percent: '+10%' });

                    if (t <= 19) {
                        mode = 'ì „ë°˜ì „ (T â‰¤ 20)';
                        buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg, amount: buyAmt / 2, percent: '0%' });
                        buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg * (1 + locPercent/100), amount: buyAmt / 2, percent: `${locPercent}%` });
                    } else {
                        mode = 'í›„ë°˜ì „ (T > 20)';
                        buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg * (1 + locPercent/100), amount: buyAmt, percent: `${locPercent}%` });
                    }
                }
                return { mode, buyOrders, sellOrders, message };
            };

            const result = calculateV2();

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="flex items-center gap-3 mb-6">
                        <button onClick={onBack} className="p-2 hover:bg-slate-200 rounded-full transition-colors mr-2" aria-label="ë’¤ë¡œ ê°€ê¸°"><Icons.ArrowLeft size={24} className="text-slate-600" /></button>
                        <div className="bg-indigo-600 text-white p-2 rounded-lg"><Icons.Calculator size={24} /></div>
                        <h2 className="text-2xl font-bold">V2.2 ê³„ì‚°ê¸°</h2>
                    </div>
                    <div className="grid lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-1 space-y-6 bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-fit">
                            <h3 className="text-lg font-bold text-slate-800 border-b pb-2">ê¸°ë³¸ ì„¤ì •</h3>
                            <InputField label="í˜„ì¬ ì§„í–‰ íšŒì°¨ (T)" value={tValue} onChange={setTValue} placeholder="ì˜ˆ: 1" step="1" />
                            <InputField label="ë‚´ í‰ë‹¨ê°€ ($)" value={avgPrice} onChange={setAvgPrice} prefix="$" placeholder="0.00" />
                            <InputField label="í˜„ì¬ ë³´ìœ  ìˆ˜ëŸ‰ (ê°œ)" value={totalQuantity} onChange={setTotalQuantity} placeholder="0" />
                            <InputField label="1íšŒ ë§¤ìˆ˜ ì„¤ì •ê¸ˆì•¡ ($)" value={oneTimeBuyAmount} onChange={setOneTimeBuyAmount} prefix="$" placeholder="1000" />
                            <div className="text-xs text-slate-500 bg-slate-100 p-2 rounded">* ì¿¼í„°ì†ì ˆ ëª¨ë“œëŠ” Tê°’ì„ 41 ì´ìƒìœ¼ë¡œ ì…ë ¥í•˜ë©´ ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤.</div>
                        </div>
                        <div className="lg:col-span-2 space-y-6">
                            {result ? (
                                <>
                                    <div className="bg-white p-6 rounded-xl shadow-sm border border-slate-100 flex justify-between items-center">
                                        <div><span className="text-sm text-slate-500 font-medium">í˜„ì¬ ëª¨ë“œ</span><div className="text-xl font-bold text-indigo-600">{result.mode}</div></div>
                                        {result.message && (<div className="text-sm text-amber-600 bg-amber-50 px-3 py-1 rounded-full max-w-[200px] text-right">{result.message}</div>)}
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-blue-50 border border-blue-100 rounded-xl overflow-hidden">
                                            <div className="bg-blue-100 px-6 py-3 border-b border-blue-200 flex items-center justify-between"><h3 className="font-bold text-blue-800">ì˜¤ëŠ˜ì˜ ë§¤ìˆ˜ (LOC)</h3><span className="text-xs font-medium bg-blue-200 text-blue-800 px-2 py-1 rounded">ì˜¤í›„ 5-6ì‹œ ì„¤ì •</span></div>
                                            <div className="p-6 space-y-4">
                                                {result.buyOrders.map((order, idx) => (
                                                    <div key={idx} className="flex justify-between items-center pb-2 last:pb-0 border-b last:border-0 border-blue-200">
                                                        <div><div className="text-2xl font-bold text-blue-900">{formatCurrency(order.price)}</div><div className="text-sm text-blue-600 font-medium">í‰ë‹¨ëŒ€ë¹„ {order.percent}</div></div>
                                                        <div className="text-right"><div className="font-semibold text-blue-900">{typeof order.amount === 'string' ? order.amount : formatCurrency(order.amount)}</div><div className="text-xs text-blue-500">ë§¤ìˆ˜ ê¸ˆì•¡</div></div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                        <div className="bg-rose-50 border border-rose-100 rounded-xl overflow-hidden">
                                            <div className="bg-rose-100 px-6 py-3 border-b border-rose-200 flex items-center justify-between"><h3 className="font-bold text-rose-800">ì˜¤ëŠ˜ì˜ ë§¤ë„</h3><span className="text-xs font-medium bg-rose-200 text-rose-800 px-2 py-1 rounded">ì „í›„ë°˜ ê³µí†µ</span></div>
                                            <div className="p-6 space-y-4">
                                                {result.sellOrders.map((order, idx) => (
                                                    <div key={idx} className="flex justify-between items-center pb-2 last:pb-0 border-b last:border-0 border-rose-200">
                                                        <div><div className="text-2xl font-bold text-rose-900">{formatCurrency(order.price)}</div><div className="text-sm text-rose-600 font-medium">{order.type} <span className="text-rose-400">({order.percent})</span></div></div>
                                                        <div className="text-right"><div className="font-semibold text-rose-900">{formatNumber(order.qty)} ì£¼</div><div className="text-xs text-rose-500">{Math.round((order.qty / totalQuantity) * 100)}% ë¬¼ëŸ‰</div></div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-slate-400 bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl min-h-[300px]"><Icons.Calculator size={48} className="mb-4 opacity-50" /><p>ì¢Œì¸¡ì— ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p></div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        function Version3Calculator({ onBack }) {
            const [ticker, setTicker] = useState('TQQQ');
            const [tValue, setTValue] = useState(1);
            const [avgPrice, setAvgPrice] = useState('');
            const [totalQuantity, setTotalQuantity] = useState('');
            const [principal, setPrincipal] = useState(20000);
            const [profit, setProfit] = useState(0);

            const calculateV3 = () => {
                const t = parseFloat(tValue) || 0;
                const avg = parseFloat(avgPrice) || 0;
                const qty = parseFloat(totalQuantity) || 0;
                const currentPrincipal = parseFloat(principal) || 0;
                const currentProfit = parseFloat(profit) || 0;

                if (!avg || !currentPrincipal) return null;

                let baseBuyAmount = currentPrincipal / 20;
                if (currentProfit > 0) baseBuyAmount += (currentProfit / 40);
                
                let starPercent = 0;
                let targetSellPercent = 0;

                if (ticker === 'TQQQ') {
                    starPercent = 15 - (1.5 * t);
                    targetSellPercent = 15;
                } else { 
                    starPercent = 20 - (2 * t);
                    targetSellPercent = 20;
                }

                let mode = '';
                let buyOrders = [];
                let sellOrders = [];
                let note = '';

                if (t <= 19) {
                    if (starPercent > 0) {
                        mode = 'ì „ë°˜ì „ (ë³„% > 0)';
                        buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg * (1 + starPercent/100), amount: baseBuyAmount / 2, percent: `${starPercent.toFixed(1)}%` });
                        buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg, amount: baseBuyAmount / 2, percent: '0%' });
                    } else {
                        mode = 'í›„ë°˜ì „ (ë³„% â‰¤ 0)';
                        buyOrders.push({ type: 'LOC ë§¤ìˆ˜', price: avg * (1 + starPercent/100), amount: baseBuyAmount, percent: `${starPercent.toFixed(1)}%` });
                    }
                    sellOrders.push({ type: 'LOC ë§¤ë„ (ì¿¼í„°)', price: avg * (1 + starPercent/100), qty: qty * 0.25, percent: `${starPercent.toFixed(1)}%` });
                    sellOrders.push({ type: 'ì§€ì •ê°€ ë§¤ë„', price: avg * (1 + targetSellPercent/100), qty: qty * 0.75, percent: `+${targetSellPercent}%` });
                } else {
                    mode = 'ì¿¼í„°ë§¤ë„ ëª¨ë“œ (20íšŒì°¨~)';
                    note = 'ì˜¤ëŠ˜ì€ ë§¤ìˆ˜ ì‹œë„ê°€ ì—†ìŠµë‹ˆë‹¤. ì¥ ë§ˆê°(MOC)ì— ì‹œì¥ê°€ë¡œ 1/4ì„ ë§¤ë„í•˜ì„¸ìš”.';
                    sellOrders.push({ type: 'MOC ë§¤ë„ (ì‹œì¥ê°€)', price: null, qty: qty * 0.25, percent: 'ì‹œì¥ê°€' });
                    sellOrders.push({ type: 'ì§€ì •ê°€ ë§¤ë„', price: avg * (1 + targetSellPercent/100), qty: qty * 0.75, percent: `+${targetSellPercent}%` });
                }
                return { mode, starPercent, baseBuyAmount, buyOrders, sellOrders, note, targetSellPercent };
            };

            const result = calculateV3();

            return (
                <div className="max-w-4xl mx-auto">
                    <div className="flex items-center justify-between mb-6">
                        <div className="flex items-center gap-3">
                            <button onClick={onBack} className="p-2 hover:bg-slate-200 rounded-full transition-colors mr-2" aria-label="ë’¤ë¡œ ê°€ê¸°"><Icons.ArrowLeft size={24} className="text-slate-600" /></button>
                            <div className="bg-emerald-600 text-white p-2 rounded-lg"><Icons.Briefcase size={24} /></div>
                            <h2 className="text-2xl font-bold">V3.0 (20ë¶„í• )</h2>
                        </div>
                        <div className="bg-slate-200 p-1 rounded-lg flex">
                            <button onClick={() => setTicker('TQQQ')} className={`px-4 py-2 rounded-md font-bold text-sm transition-all ${ticker === 'TQQQ' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>TQQQ</button>
                            <button onClick={() => setTicker('SOXL')} className={`px-4 py-2 rounded-md font-bold text-sm transition-all ${ticker === 'SOXL' ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-500 hover:text-slate-700'}`}>SOXL</button>
                        </div>
                    </div>
                    <div className="grid lg:grid-cols-3 gap-6">
                        <div className="lg:col-span-1 space-y-6 bg-white p-6 rounded-xl shadow-sm border border-slate-100 h-fit">
                            <h3 className="text-lg font-bold text-slate-800 border-b pb-2">ê¸°ë³¸ ì„¤ì •</h3>
                            <div className="bg-slate-50 p-3 rounded-lg border border-slate-200 space-y-3">
                                <label className="text-xs font-bold text-slate-500 uppercase">ìê¸ˆ ì„¤ì •</label>
                                <InputField label="ì´ ì›ê¸ˆ ($)" value={principal} onChange={setPrincipal} prefix="$" placeholder="20000" />
                                <InputField label="ëˆ„ì  ìˆ˜ìµê¸ˆ ($)" value={profit} onChange={setProfit} prefix="$" placeholder="0" />
                                <p className="text-xs text-slate-400">* ìˆ˜ìµê¸ˆì˜ 1/40ì´ ë§¤íšŒ ë§¤ìˆ˜ê¸ˆì— ì¶”ê°€ë©ë‹ˆë‹¤.</p>
                            </div>
                            <div className="space-y-3">
                                <InputField label="í˜„ì¬ ì§„í–‰ íšŒì°¨ (T)" value={tValue} onChange={setTValue} placeholder="1~20" step="1" />
                                <InputField label="ë‚´ í‰ë‹¨ê°€ ($)" value={avgPrice} onChange={setAvgPrice} prefix="$" placeholder="0.00" />
                                <InputField label="í˜„ì¬ ë³´ìœ  ìˆ˜ëŸ‰ (ê°œ)" value={totalQuantity} onChange={setTotalQuantity} placeholder="0" />
                            </div>
                        </div>
                        <div className="lg:col-span-2 space-y-6">
                            {result ? (
                                <>
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100"><span className="text-sm text-slate-500 font-medium">ì˜¤ëŠ˜ì˜ ë³„(Star) %</span><div className={`text-2xl font-bold ${result.starPercent > 0 ? 'text-red-500' : 'text-blue-500'}`}>{result.starPercent.toFixed(2)}%</div></div>
                                        <div className="bg-white p-4 rounded-xl shadow-sm border border-slate-100"><span className="text-sm text-slate-500 font-medium">1íšŒ ë§¤ìˆ˜ê¸ˆì•¡</span><div className="text-2xl font-bold text-slate-800">{formatCurrency(result.baseBuyAmount)}</div></div>
                                    </div>
                                    <div className="flex items-center justify-between bg-emerald-50 text-emerald-900 px-4 py-3 rounded-lg border border-emerald-100">
                                        <span className="font-bold">{result.mode}</span><span className="text-sm">{ticker} ê¸°ì¤€ ({ticker === 'TQQQ' ? '15' : '20'} - {ticker === 'TQQQ' ? '1.5' : '2'}T)</span>
                                    </div>
                                    {result.note && (<div className="bg-amber-50 border border-amber-200 text-amber-800 p-4 rounded-lg flex gap-3 items-start"><Icons.AlertCircle size={20} className="mt-1 flex-shrink-0" /><p className="text-sm font-medium">{result.note}</p></div>)}
                                    <div className="grid md:grid-cols-2 gap-6">
                                        <div className="bg-blue-50 border border-blue-100 rounded-xl overflow-hidden">
                                            <div className="bg-blue-100 px-6 py-3 border-b border-blue-200 flex items-center justify-between"><h3 className="font-bold text-blue-800">ë§¤ìˆ˜ ì£¼ë¬¸</h3><span className="text-xs font-medium bg-blue-200 text-blue-800 px-2 py-1 rounded">LOC</span></div>
                                            <div className="p-6 space-y-4">
                                                {result.buyOrders.length > 0 ? result.buyOrders.map((order, idx) => (
                                                    <div key={idx} className="flex justify-between items-center pb-2 last:pb-0 border-b last:border-0 border-blue-200">
                                                        <div><div className="text-2xl font-bold text-blue-900">{formatCurrency(order.price)}</div><div className="text-sm text-blue-600 font-medium">í‰ë‹¨ëŒ€ë¹„ <span className={parseFloat(order.percent) > 0 ? 'text-red-500' : 'text-blue-600'}>{order.percent}</span></div></div>
                                                        <div className="text-right"><div className="font-semibold text-blue-900">{formatCurrency(order.amount)}</div><div className="text-xs text-blue-500">ë§¤ìˆ˜ ì„¤ì •ê¸ˆ</div></div>
                                                    </div>
                                                )) : (<div className="text-center text-blue-400 py-4">ë§¤ìˆ˜ ì£¼ë¬¸ ì—†ìŒ</div>)}
                                            </div>
                                        </div>
                                        <div className="bg-rose-50 border border-rose-100 rounded-xl overflow-hidden">
                                            <div className="bg-rose-100 px-6 py-3 border-b border-rose-200 flex items-center justify-between"><h3 className="font-bold text-rose-800">ë§¤ë„ ì£¼ë¬¸</h3><span className="text-xs font-medium bg-rose-200 text-rose-800 px-2 py-1 rounded">ì§€ì •ê°€/LOC</span></div>
                                            <div className="p-6 space-y-4">
                                                {result.sellOrders.map((order, idx) => (
                                                    <div key={idx} className="flex justify-between items-center pb-2 last:pb-0 border-b last:border-0 border-rose-200">
                                                        <div>{order.price ? (<div className="text-2xl font-bold text-rose-900">{formatCurrency(order.price)}</div>) : (<div className="text-xl font-bold text-rose-900">ì‹œì¥ê°€(MOC)</div>)}<div className="text-sm text-rose-600 font-medium">{order.type} <span className="text-rose-400">({order.percent})</span></div></div>
                                                        <div className="text-right"><div className="font-semibold text-rose-900">{formatNumber(order.qty)} ì£¼</div><div className="text-xs text-rose-500">{Math.round((order.qty / totalQuantity) * 100)}% ë¬¼ëŸ‰</div></div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <div className="h-full flex flex-col items-center justify-center text-slate-400 bg-slate-50 border-2 border-dashed border-slate-200 rounded-xl min-h-[300px]"><Icons.Briefcase size={48} className="mb-4 opacity-50" /><p>ì¢Œì¸¡ì— ë°ì´í„°ë¥¼ ì…ë ¥í•˜ë©´ V3.0 ê²°ê³¼ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p></div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

        // --- Service Worker ë“±ë¡ (PWA ê¸°ëŠ¥) ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>